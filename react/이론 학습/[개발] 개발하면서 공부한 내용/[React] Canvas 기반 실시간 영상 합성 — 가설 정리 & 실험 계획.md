# [React] Canvas 기반 실시간 영상 합성 — 가설 정리 & 실험 계획

> **Date:** 2026-01-22
> **Tag:** #Frontend #Canvas #WebRTC #Rendering #Performance #TIL

---

> ⚠️ **이 글은 구현 완료 보고가 아니라, 기술 선택에 대한 가설 정리와 앞으로 진행할 실험 계획을 기록한 TIL이다.**
> Canvas 기반 합성이 CSS 레이어링보다 적합하다는 결론을 *확정*한 것이 아니라, **검증해야 할 가설과 테스트 항목을 명확히 정의**하는 것이 목적이다.

---

## 📋 목차

1. [배경: 왜 검증이 필요한가?](#1-배경-왜-검증이-필요한가)
2. [비교 대상 정의 (Canvas vs CSS 레이어링)](#2-비교-대상-정의-canvas-vs-css-레이어링)
3. [핵심 가설 정리](#3-핵심-가설-정리)
4. [실험 환경 및 조건 계획](#4-실험-환경-및-조건-계획)
5. [테스트 항목 체크리스트](#5-테스트-항목-체크리스트)
6. [측정 지표 및 수집 방법](#6-측정-지표-및-수집-방법)
7. [예상 결과 및 판단 기준](#7-예상-결과-및-판단-기준)
8. [다음 단계](#8-다음-단계)

---

## 1. 배경: 왜 검증이 필요한가?

실시간 WebRTC 영상 2개(로컬 + AI 스트림)를 합성해야 하는 상황에서, 일반적으로 떠올릴 수 있는 방식은 다음 두 가지다.

* 여러 개의 `<video>` 요소를 **CSS z-index로 겹치는 방식**
* 하나의 `<canvas>`에 `drawImage`로 **프레임 단위 합성하는 방식**

자료 조사와 경험적 추론을 통해 Canvas가 더 적합할 것이라 판단했지만, **실제 성능 차이는 환경에 따라 달라질 수 있다.**
따라서 명확한 근거를 확보하기 위해 실험이 필요하다.

---

## 2. 비교 대상 정의 (Canvas vs CSS 레이어링)

### 방식 A — CSS 레이어링

* 각 스트림을 개별 `<video>` 요소로 렌더링
* `position: absolute` + `z-index`로 겹침
* 드래그 및 위치 제어는 DOM 이벤트 기반

### 방식 B — Canvas 합성

* 각 스트림을 hidden `<video>`에 연결
* 단일 `<canvas>`에서 `drawImage`로 합성
* 렌더링은 `requestAnimationFrame` 루프

---

## 3. 핵심 가설 정리

아래는 이번 구조 설계에서 **검증해야 할 가설**들이다.

1. Canvas 합성은 CSS 레이어링보다 **프레임 동기화가 더 안정적이다**
2. Canvas 방식은 DOM 노드 수가 적어 **reflow / repaint 비용이 낮다**
3. `requestAnimationFrame` 기반 렌더링이 **입력 지연(latency)을 줄인다**
4. draw order 제어로 Canvas에서도 **z-index 개념을 대체할 수 있다**
5. 스트림 수가 늘어날수록 Canvas 방식의 **확장성이 더 좋다**

---

## 4. 실험 환경 및 조건 계획

### 공통 환경

* Chrome 최신 버전
* 동일한 WebRTC 스트림 소스 사용
* 동일한 해상도 (예: 192×144)
* 동일한 네트워크 환경

### 실험 시나리오

* 로컬 스트림 + AI 스트림 2개 합성
* 영상 이동(드래그) 지속적으로 발생
* 30초 이상 연속 렌더링

---

## 5. 테스트 항목 체크리스트

### 렌더링 성능

* [ ] 평균 FPS 측정
* [ ] 프레임 드롭 발생 여부
* [ ] 드래그 중 끊김 현상

### 지연 및 동기화

* [ ] 입력 → 화면 반영 체감 지연
* [ ] 두 영상 간 프레임 어긋남 여부

### 브라우저 부하

* [ ] CPU 사용량 비교
* [ ] 메모리 사용량 변화
* [ ] 장시간 실행 시 성능 저하

### 구현 난이도

* [ ] 코드 복잡도
* [ ] 상태 관리 난이도
* [ ] 디버깅 용이성

---

## 6. 측정 지표 및 수집 방법

* Chrome DevTools Performance 탭
* FPS meter
* React DevTools (렌더링 영향 확인)
* 체감 UX 메모 (주관적 기록도 병행)

수치는 절대값보다 **방식 간 상대 비교**에 초점을 둔다.

---

## 7. 예상 결과 및 판단 기준

Canvas 방식이 다음 조건을 만족하면 채택을 확정할 계획이다.

* FPS가 CSS 방식보다 안정적일 것
* 입력 지연이 눈에 띄게 줄어들 것
* 스트림 추가 시 구조 변경 비용이 낮을 것

만약 차이가 미미하다면, **단순성과 유지보수성을 기준으로 재판단**한다.

---

## 8. 다음 단계

* [ ] Canvas vs CSS 실제 프로토타입 2종 구현
* [ ] 측정 결과 정리 후 후속 TIL 작성
* [ ] 스트림 3개 이상 시나리오 확장 테스트
* [ ] 필요 시 WebGL 기반 구조 설계 검토
